allow:
  # - write=app.log
  # - read=.env
  - env
  - net
envFile:
  - .env

scripts:
  start:
    desc: Runs main script
    cmd: main.ts

  dev:
    desc: Starts local server
    cmd: deployctl run --libs="" --watch --env=.env ./server.ts

  lint:
    cmd: deno lint
    desc: Runs lint
    gitHook: pre-commit

  fmt:
    cmd: |
      FILES=$(git diff --cached --name-only --diff-filter=ACMR "*.ts")
      [ -z "$FILES" ] && exit 0
      echo "$FILES" | xargs deno fmt
      echo "$FILES" | xargs git add
    desc: Formats staged files
    gitHook: pre-commit

  test:
    cmd: deno test -Ar --coverage=cov_profile
    desc: Runs the tests
    gitHook: pre-push

  cov:
    cmd: deno coverage cov_profile
    desc: Shows uncovered lists

  ci:
    cmd:
      - vr lint
      - deno fmt --check
      - vr test
    desc: Runs lint, check format and test
